<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Login / Registrazione</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap" rel="stylesheet">

  <style>
    * {margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    html,body{display:grid;height:100%;width:100%;place-items:center;background:linear-gradient(45deg,#003366,#004080,#0059b3,#0073e6);}
    .wrapper{overflow:hidden;max-width:390px;width:100%;background:#fff;padding:25px;border-radius:15px;}
    .title-text{display:flex;width:200%;}
    .title{width:50%;font-size:24px;text-align:center;transition:.6s cubic-bezier(0.68,-0.55,0.265,1.55);}
    .slide-controls{position:relative;display:flex;height:50px;border:1px solid #ccc;border-radius:15px;margin:20px 0;overflow:hidden;}
    .slide-controls label{width:50%;text-align:center;line-height:50px;cursor:pointer;}
    .slider-tab{position:absolute;width:50%;height:50px;background:linear-gradient(45deg,#003366,#004080,#0059b3,#0073e6);border-radius:15px;transition:.6s cubic-bezier(0.68,-0.55,0.265,1.55);}
    input[type=radio]{display:none;}
    #signup:checked ~ .slider-tab{transform:translateX(100%);}
    .form-inner{display:flex;width:200%;transition:.6s cubic-bezier(0.68,-0.55,0.265,1.55);}
    #signup:checked ~ .form-inner{margin-left:-50%;}
    form .field{margin-bottom:15px;}
    form input{width:100%;height:45px;padding:0 15px;border-radius:12px;border:1px solid #ccc;}
    .btn input{background:linear-gradient(45deg,#003366,#004080,#0059b3,#0073e6);border:none;color:#fff;cursor:pointer;width:100%;height:45px;border-radius:12px;font-weight:600;}
    .error-msg{display:none;background:#fee2e2;color:#b91c1c;font-size:13px;padding:6px;border-radius:12px;text-align:center;margin-top:6px;}
    .error-msg.visible{display:block;}
  </style>
</head>

<body>

  <div class="wrapper">
    <div class="title-text">
      <div class="title">Login</div>
      <div class="title">Registrazione</div>
    </div>

    <div class="slide-controls">
      <input type="radio" name="slide" id="login" checked />
      <input type="radio" name="slide" id="signup" />
      <label for="login">Login</label>
      <label for="signup">Signup</label>
      <div class="slider-tab"></div>
    </div>

    <div class="form-inner">

      <!-- LOGIN -->
      <form id="login-form">
        <div class="field">
          <input type="email" id="login-email" placeholder="Email" required />
        </div>
        <div class="field">
          <input type="password" id="login-password" placeholder="Password" required />
        </div>
        <div class="btn">
          <input type="submit" value="Login" />
        </div>
        <div id="login-error" class="error-msg"></div>
      </form>

      <!-- SIGNUP -->
      <form id="signup-form">
        <div class="field">
          <input type="text" id="signup-name" placeholder="Nome e cognome" required />
        </div>
        <div class="field">
          <input type="email" id="signup-email" placeholder="Email" required />
        </div>
        <div class="field">
          <input type="password" id="signup-password" placeholder="Password" required />
        </div>
        <div class="field">
          <input type="password" id="signup-password2" placeholder="Conferma password" required />
        </div>
        <div class="field">
          <input type="text" id="signup-code" placeholder="Codice aziendale" required />
        </div>
        <div class="btn">
          <input type="submit" value="Registrati" />
        </div>
        <div id="signup-error" class="error-msg"></div>
      </form>

    </div>
  </div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    /***** CONFIG FIREBASE ******/
    const firebaseConfig = {
      apiKey: "AIzaSyDWisOm9z0LrSV0BczsKD5qYuVfswwT7jw",
      authDomain: "progetto-cooperativa-passioni.firebaseapp.com",
      databaseURL: "https://progetto-cooperativa-passioni-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "progetto-cooperativa-passioni",
      storageBucket: "progetto-cooperativa-passioni.firebasestorage.app",
      messagingSenderId: "578783174328",
      appId: "1:578783174328:web:9770c86aa93d7fa3055e4d"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    const COMPANY_CODE = "ABC123"; // MODIFICA TU

    function setError(id,msg){
      const el=document.getElementById(id);
      if(!msg){el.classList.remove('visible');return;}
      el.textContent=msg;
      el.classList.add('visible');
    }

    /*************** LOGIN ***************/
    document.getElementById("login-form").addEventListener("submit",e=>{
      e.preventDefault();
      setError("login-error","");

      const email=document.getElementById("login-email").value.trim();
      const password=document.getElementById("login-password").value;

      if(!email||!password){
        setError("login-error","Compila tutti i campi");
        return;
      }
      if(!email.includes("@")){
        setError("login-error","Email non valida");
        return;
      }

      auth.signInWithEmailAndPassword(email,password)
        .then(()=>location.href="index.html")
        .catch(()=>setError("login-error","Credenziali non valide"));
    });

    /*************** SIGNUP ***************/
    document.getElementById("signup-form").addEventListener("submit",async e=>{
      e.preventDefault();
      setError("signup-error","");

      const name=document.getElementById("signup-name").value.trim();
      const email=document.getElementById("signup-email").value.trim();
      const p1=document.getElementById("signup-password").value;
      const p2=document.getElementById("signup-password2").value;
      const code=document.getElementById("signup-code").value.trim();

      if(!name||!email||!p1||!p2||!code){
        setError("signup-error","Compila tutti i campi");
        return;
      }
      if(!email.includes("@")){
        setError("signup-error","Email non valida");
        return;
      }
      if(p1.length<6){
        setError("signup-error","Password minimo 6 caratteri");
        return;
      }
      if(p1!==p2){
        setError("signup-error","Le password non coincidono");
        return;
      }
      if(code!==COMPANY_CODE){
        setError("signup-error","Codice aziendale errato");
        return;
      }

      try{
        const cred=await auth.createUserWithEmailAndPassword(email,p1);
        await db.collection("profiles").doc(cred.user.uid).set({
          name,email,createdAt:firebase.firestore.FieldValue.serverTimestamp()
        });
        location.href="index.html";
      } catch(err){
        setError("signup-error","Email giÃ  registrata");
      }
    });
  </script>

</body>
</html>
