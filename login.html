<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>La Comunità</title>

  <style>
    body{
      background: linear-gradient(135deg,#003366,#0073e6);
      margin:0;
      font-family: Arial, sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      padding:20px;
    }

    .card{
      background:#fff;
      width:100%;
      max-width:420px;
      border-radius:15px;
      padding:24px;
      box-shadow:0 10px 40px rgba(0,0,0,0.15);
    }

    h2{
      text-align:center;
      margin-bottom:10px;
    }

    .toggle{
      display:flex;
      background:#f0f0f0;
      border-radius:10px;
      overflow:hidden;
      margin-bottom:20px;
    }

    .toggle button{
      flex:1;
      padding:10px;
      border:none;
      background:none;
      cursor:pointer;
      font-weight:bold;
    }

    .toggle button.active{
      background:#0073e6;
      color:#fff;
    }

    .form{
      display:none;
      flex-direction:column;
      gap:12px;
    }

    .form.active{
      display:flex;
    }

    input{
      padding:12px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:15px;
      width:100%;
    }

    .btn{
      padding:12px;
      border:none;
      border-radius:8px;
      background:linear-gradient(135deg,#003366,#0073e6);
      color:#fff;
      font-weight:bold;
      cursor:pointer;
      margin-top:10px;
    }

    .error{
      background:#ffe0e0;
      color:#b30000;
      padding:8px;
      border-radius:8px;
      text-align:center;
      display:none;
    }
  </style>
</head>

<body>

<div class="card">
  <h2>La Comunità</h2>

  <div class="toggle">
    <button id="btn-login" class="active">Login</button>
    <button id="btn-signup">Registrati</button>
  </div>

  <div id="error-box" class="error"></div>

  <!-- LOGIN -->
  <form id="login-form" class="form active">
    <input type="email" id="login-email" placeholder="Email aziendale" required>
    <input type="password" id="login-password" placeholder="Password" required>
    <button class="btn" type="button" onclick="login()">Login</button>
  </form>

  <!-- SIGNUP -->
  <form id="signup-form" class="form">
    <input type="text" id="signup-name" placeholder="Nome e cognome" required>
    <input type="email" id="signup-email" placeholder="Email aziendale" required>
    <input type="password" id="signup-password" placeholder="Password (min 6 caratteri)" required>
    <input type="password" id="signup-confirm" placeholder="Conferma password" required>
    <input type="text" id="signup-code" placeholder="Codice aziendale" required>

    <button class="btn" type="button" onclick="signup()">Signup</button>
  </form>
</div>

<script>
/* --- UI TOGGLE --- */
const loginForm  = document.getElementById("login-form");
const signupForm = document.getElementById("signup-form");
const btnLogin   = document.getElementById("btn-login");
const btnSignup  = document.getElementById("btn-signup");

btnLogin.onclick = () => {
  loginForm.classList.add("active");
  signupForm.classList.remove("active");
  btnLogin.classList.add("active");
  btnSignup.classList.remove("active");
};

btnSignup.onclick = () => {
  signupForm.classList.add("active");
  loginForm.classList.remove("active");
  btnSignup.classList.add("active");
  btnLogin.classList.remove("active");
};

/* --- ERROR DISPLAY --- */
function showError(msg){
  const box = document.getElementById("error-box");
  box.innerText = msg;
  box.style.display = "block";
}

function clearError(){
  document.getElementById("error-box").style.display = "none";
}

/* --- LOGIN --- */
function login(){
  clearError();
  const email = document.getElementById("login-email").value;
  const pass  = document.getElementById("login-password").value;

  if(!email || !pass){
    showError("Compila tutti i campi.");
    return;
  }

  firebase.auth().signInWithEmailAndPassword(email, pass)
  .then(()=> window.location.href="home.html")
  .catch(e=> showError(e.message));
}

/* --- SIGNUP VALIDATION + FIREBASE --- */
function signup(){
  clearError();

  const name   = document.getElementById("signup-name").value;
  const email  = document.getElementById("signup-email").value;
  const pass   = document.getElementById("signup-password").value;
  const confirm= document.getElementById("signup-confirm").value;
  const code   = document.getElementById("signup-code").value;

  if(!name || !email || !pass || !confirm || !code){
    showError("Compila tutti i campi.");
    return;
  }

  if(!email.includes("@") || !email.includes(".")){
    showError("Formato email non valido.");
    return;
  }

  if(email.split("@")[1].split(".")[0] !== "azienda"){
    showError("Email NON aziendale.");
    return;
  }

  if(pass.length < 6){
    showError("Password troppo corta.");
    return;
  }

  if(pass !== confirm){
    showError("Le password non coincidono.");
    return;
  }

  if(code !== "ABC123"){
    showError("Codice aziendale errato.");
    return;
  }

  firebase.auth().createUserWithEmailAndPassword(email, pass)
  .then(()=> window.location.href="home.html")
  .catch(e=> showError(e.message));
}
</script>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "XXXX",
  authDomain: "XXXX.firebaseapp.com",
  projectId: "XXXX",
});
</script>

</body>
</html>
